<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title data-lang-key="meta_title">ePrime Solar: Расчет экономии на солнечных панелях в Молдове</title>
    <meta name="description" data-lang-key="meta_description" content="Узнайте, сколько вы можете сэкономить с солнечной станцией от ePrime.md. Пройдите быстрый калькулятор и получите расчет и 3D-проект на WhatsApp.">
    
    <meta name="keywords" content="солнечные панели Молдова, установка солнечных станций, eprime.md, расчет экономии солнечные панели, panouri solare Moldova, instalare stații solare, energie verde Chișinău">

    <link rel="icon" href="https://eprime.md/wp-content/uploads/2023/04/cropped-favicon-32x32.png" sizes="32x32">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/css/intlTelInput.css">
    
    <style>
        /* --- Общие стили и переменные --- */
        :root {
            --primary-color: #28a745;
            --primary-hover: #218838;
            --secondary-color: #007bff;
            --accent-color: #ffc107;
            --error-color: #dc3545;
            --success-color: #28a745;
            --text-color: #333;
            --text-light: #666;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e9ecef;
            --border-radius: 16px;
            --border-radius-small: 8px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --box-shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* --- Контейнер --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Шапка --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .header .logo img {
            max-height: 45px;
            transition: var(--transition);
        }
        
        .header .logo img:hover {
            transform: scale(1.05);
        }
        
        .lang-switcher {
            display: flex;
            gap: 5px;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            padding: 6px;
            background: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .lang-switcher button {
            border: none;
            background: transparent;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .lang-switcher button.active {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        /* --- Главный экран (Hero) --- */
        .hero {
            text-align: center;
            padding: 80px 20px;
            transition: var(--transition);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            margin-bottom: 40px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.3;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .hero h1 {
            font-size: 3.2rem;
            margin-bottom: 20px;
            line-height: 1.2;
            color: white;
            font-weight: 800;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 1s ease-out;
        }
        
        .hero .highlight {
            color: var(--accent-color);
            text-shadow: 0 2px 10px rgba(255, 193, 7, 0.5);
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 40px;
            color: rgba(255, 255, 255, 0.95);
            animation: fadeInUp 1s ease-out 0.2s both;
        }
        
        .cta-button {
            background: linear-gradient(135deg, var(--accent-color), #ffb300);
            color: #333;
            border: none;
            padding: 20px 50px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
            animation: fadeInUp 1s ease-out 0.4s both;
            position: relative;
            overflow: hidden;
        }
        
        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .cta-button:hover::before {
            left: 100%;
        }
        
        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 193, 7, 0.6);
        }
        
        /* --- Модальное окно Калькулятора --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .calculator-modal {
            background: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--box-shadow-hover);
            transform: scale(0.8) translateY(50px);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .modal-overlay.active .calculator-modal {
            transform: scale(1) translateY(0);
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.1);
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
            transform: rotate(90deg);
        }
        
        .calc-step {
            display: none;
            animation: slideInRight 0.5s ease-out;
        }
        
        .calc-step.active {
            display: block;
        }
        
        .calc-step h3 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
            color: var(--text-color);
            font-weight: 700;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .option-btn {
            background: var(--bg-color);
            border: 3px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 25px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: var(--text-color);
            position: relative;
            overflow: hidden;
        }
        
        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            opacity: 0;
            transition: var(--transition);
            z-index: 1;
        }
        
        .option-btn .icon {
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .option-btn .icon svg {
            width: 40px;
            height: 40px;
            transition: var(--transition);
            stroke-width: 2;
            color: var(--text-color);
        }
        
        .option-btn span {
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .option-btn:hover {
            transform: translateY(-8px);
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow-hover);
        }
        
        .option-btn:hover::before {
            opacity: 1;
        }
        
        .option-btn:hover .icon svg,
        .option-btn:hover span {
            color: white;
        }
        
        .option-btn:hover .icon {
            transform: scale(1.2);
        }
        
        /* --- Результаты и Форма --- */
        #results-step {
            text-align: center;
            animation: fadeIn 0.8s ease-out;
        }
        
        .results-container {
            display: flex;
            justify-content: space-around;
            gap: 25px;
            margin: 30px 0;
        }
        
        .result-item {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            padding: 25px 20px;
            border-radius: var(--border-radius);
            width: 100%;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .result-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow-hover);
        }
        
        .result-item h4 {
            margin: 0 0 10px;
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 600;
        }
        
        .result-item p {
            margin: 0;
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 2px 5px rgba(40, 167, 69, 0.2);
        }
        
        #phone-form {
            margin-top: 30px;
        }
        
        .form-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        #phone {
            width: 100%;
            box-sizing: border-box;
            padding: 18px 18px 18px 100px;
            border: 3px solid var(--border-color);
            border-radius: var(--border-radius-small);
            font-size: 1.1rem;
            transition: var(--transition);
            background: var(--card-bg);
        }
        
        #phone:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 5px rgba(40, 167, 69, 0.1);
            transform: scale(1.02);
        }
        
        #phone.error {
            border-color: var(--error-color);
            animation: shake 0.5s ease-in-out;
        }
        
        .iti { 
            width: 100%; 
        }
        
        #error-msg {
            color: var(--error-color);
            font-size: 0.9rem;
            margin-top: 8px;
            display: none;
            text-align: left;
            animation: fadeIn 0.3s ease-out;
        }
        
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            margin-top: 20px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .submit-btn:hover::before {
            left: 100%;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }
        
        .submit-btn:disabled {
            background: #aaa;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .bonus-text {
            text-align: center;
            margin-top: 20px;
            font-size: 1rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .bonus-text svg {
            width: 20px;
            height: 20px;
            fill: var(--success-color);
            animation: pulse 2s infinite;
        }

        /* --- Страница Благодарности --- */
        #thank-you-page {
            display: none;
            text-align: center;
            padding: 60px 20px;
            animation: fadeIn 1s ease-out;
        }
        
        #thank-you-page h2 {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-weight: 800;
        }
        
        #thank-you-page p {
            font-size: 1.3rem;
            color: var(--text-light);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .link-cubes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 40px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .link-cube {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 30px;
            text-decoration: none;
            color: var(--text-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--box-shadow);
        }
        
        .link-cube::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            opacity: 0;
            transition: var(--transition);
            z-index: 1;
        }
        
        .link-cube .icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .link-cube h4 {
            margin: 0 0 10px;
            font-size: 1.4rem;
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .link-cube p {
            margin: 0;
            font-size: 1rem;
            color: var(--text-light);
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }
        
        .link-cube .arrow {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            color: var(--primary-color);
            opacity: 0;
            transition: var(--transition);
            z-index: 2;
        }
        
        .link-cube:hover {
            transform: translateY(-10px);
            box-shadow: var(--box-shadow-hover);
            border-color: var(--primary-color);
        }
        
        .link-cube:hover::before {
            opacity: 1;
        }
        
        .link-cube:hover .icon,
        .link-cube:hover h4,
        .link-cube:hover p,
        .link-cube:hover .arrow {
            color: white;
        }
        
        .link-cube:hover .arrow {
            opacity: 1;
            right: 15px;
        }

        .video-section {
            margin-top: 60px;
        }
        
        .video-section h3 {
            font-size: 2rem;
            color: var(--text-color);
            margin-bottom: 30px;
            font-weight: 700;
        }
        
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        
        /* --- Cookie Banner --- */
        #cookie-banner {
            position: fixed;
            bottom: -100%;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 25px;
            box-sizing: border-box;
            z-index: 2000;
            transition: bottom 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #cookie-banner.show {
            bottom: 0;
        }
        
        .cookie-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
            gap: 30px;
        }
        
        .cookie-text {
            font-size: 1rem;
            line-height: 1.5;
        }
        
        #cookie-accept-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        #cookie-accept-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Анимации */
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { 
                opacity: 0; 
                transform: translateX(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .hero p { font-size: 1.1rem; }
            .options-grid { grid-template-columns: 1fr; }
            .results-container { flex-direction: column; }
            .calculator-modal { padding: 25px; width: 95%; }
            .link-cubes-container { grid-template-columns: 1fr; }
            #thank-you-page h2 { font-size: 2.5rem; }
            .cookie-content { flex-direction: column; text-align: center; }
            .header { flex-direction: column; gap: 20px; }
        }
        
        @media (max-width: 480px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
            .cta-button { padding: 16px 30px; font-size: 1.1rem; }
            .calculator-modal { padding: 20px; }
            .option-btn { padding: 20px 15px; }
        }
    </style>
</head>
<body>

    <header class="header container">
        <div class="logo">
            <a href="https://eprime.md/" target="_blank">
                <img src="https://eprime.md/wp-content/uploads/2023/03/logo-eprime.svg" alt="ePrime Logo">
            </a>
        </div>
        <div class="lang-switcher">
            <button id="lang-ru" class="active">RU</button>
            <button id="lang-ro">RO</button>
        </div>
    </header>

    <main class="hero">
        <div class="hero-content">
            <h1 data-lang-key="hero_title">Солнце работает, <span class="highlight">вы отдыхаете</span></h1>
            <p data-lang-key="hero_subtitle">Рассчитайте вашу экономию и окупаемость солнечной станции за 45 секунд и получите 3D-проект вашей крыши в подарок!</p>
            <button class="cta-button" id="start-calc-btn" data-lang-key="hero_button">Рассчитать экономию</button>
        </div>
    </main>

    <div class="modal-overlay" id="modal">
        <div class="calculator-modal">
            <button class="modal-close" id="modal-close-btn">&times;</button>
            
            <div class="calc-step active" id="step1">
                <h3 data-lang-key="step1_title">Ваш ежемесячный счет за электроэнергию? (MDL)</h3>
                <div class="options-grid">
                    <button class="option-btn" data-next="step2" data-value="1000">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                            </svg>
                        </div>
                        <span data-lang-key="bill_1">до 1000</span>
                    </button>
                    <button class="option-btn" data-next="step2" data-value="1500">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.7" transform="translate(2, 2)"/>
                            </svg>
                        </div>
                        <span data-lang-key="bill_2">1001 - 2000</span>
                    </button>
                    <button class="option-btn" data-next="step2" data-value="2500">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.7" transform="translate(2, 2)"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.5" transform="translate(4, 4)"/>
                            </svg>
                        </div>
                        <span data-lang-key="bill_3">2001 - 3000</span>
                    </button>
                    <button class="option-btn" data-next="step2" data-value="4000">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.7" transform="translate(2, 2)"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.5" transform="translate(4, 4)"/>
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" opacity="0.3" transform="translate(6, 6)"/>
                            </svg>
                        </div>
                        <span data-lang-key="bill_4">3000+</span>
                    </button>
                </div>
            </div>

            <div class="calc-step" id="step2">
                <h3 data-lang-key="step2_title">Какой у вас тип крыши?</h3>
                <div class="options-grid">
                    <button class="option-btn" data-next="results-step" data-value="Односкатная">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 12h18l-9-9z"/>
                            </svg>
                        </div>
                        <span data-lang-key="Односкатная">Односкатная</span>
                    </button>
                    <button class="option-btn" data-next="results-step" data-value="Двускатная">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 12h18l-9-9z"/>
                                <path d="M3 12h18l-9-9z" transform="scale(-1, 1) translate(-24, 0)"/>
                            </svg>
                        </div>
                        <span data-lang-key="Двускатная">Двускатная</span>
                    </button>
                    <button class="option-btn" data-next="results-step" data-value="Плоская">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="12" width="18" height="8" rx="1"/>
                            </svg>
                        </div>
                        <span data-lang-key="Плоская">Плоская</span>
                    </button>
                    <button class="option-btn" data-next="results-step" data-value="Другой">
                        <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <path d="M12 17h.01"/>
                            </svg>
                        </div>
                        <span data-lang-key="Другой">Другой / Не знаю</span>
                    </button>
                </div>
            </div>

            <div class="calc-step" id="results-step">
                <h3 data-lang-key="results_title">Ваш предварительный расчет готов!</h3>
                <div class="results-container">
                    <div class="result-item">
                        <h4 data-lang-key="results_savings">Экономия в год с ePrime</h4>
                        <p id="annual-savings">~19 200 MDL</p>
                    </div>
                    <div class="result-item">
                        <h4 data-lang-key="results_payback">Срок окупаемости</h4>
                        <p id="payback-period">~5 лет</p>
                    </div>
                </div>
                <p data-lang-key="form_intro">Получите точный расчет, 3D-проект и специальное предложение на WhatsApp!</p>
                <form id="phone-form" novalidate>
                    <div class="form-group">
                        <input id="phone" type="tel" name="phone">
                        <div id="error-msg"></div>
                    </div>
                    <button type="submit" class="submit-btn" id="submit-lead-btn" data-lang-key="form_button">Получить расчет</button>
                    <div class="bonus-text">
                        <svg viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 16.17l7.59-7.59L19 10l-9 9z"/>
                        </svg>
                        <span data-lang-key="form_bonus">Оставив номер, вы получите бонус при монтаже</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="thank-you-page" class="container">
        <h2 data-lang-key="thanks_title">Спасибо! Ваша заявка принята!</h2>
        <p data-lang-key="thanks_subtitle">Наш специалист скоро свяжется с вами. А пока, узнайте о нас больше:</p>
        <div class="link-cubes-container">
            <a href="https://eprime.md/proiecte/" target="_blank" class="link-cube">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                </div>
                <h4 data-lang-key="link_projects_title">Наши проекты</h4>
                <p data-lang-key="link_projects_desc">Посмотрите реальные примеры наших работ.</p>
                <span class="arrow">→</span>
            </a>
            <a href="https://eprime.md/pentru-case-cloned-185/" target="_blank" class="link-cube">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </div>
                <h4 data-lang-key="link_home_title">Решения для дома</h4>
                <p data-lang-key="link_home_desc">Узнайте все о станциях для частных домов.</p>
                <span class="arrow">→</span>
            </a>
            <a href="https://eprime.md/pentru-afaceri-cloned-378/" target="_blank" class="link-cube">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <h4 data-lang-key="link_biz_title">Решения для бизнеса</h4>
                <p data-lang-key="link_biz_desc">Оптимизируйте расходы вашей компании.</p>
                <span class="arrow">→</span>
            </a>
            <a href="https://eprime.md/" target="_blank" class="link-cube">
                <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </div>
                <h4 data-lang-key="link_main_title">Основной сайт</h4>
                <p data-lang-key="link_main_desc">Перейдите на главный сайт ePrime.</p>
                <span class="arrow">→</span>
            </a>
        </div>
        <div class="video-section">
            <h3 data-lang-key="video_title">Посмотрите, как мы работаем</h3>
            <div class="video-wrapper">
                <iframe src="https://www.youtube.com/embed/iBa8dc0ycU8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <div id="cookie-banner">
        <div class="cookie-content">
            <p class="cookie-text" data-lang-key="cookie_text">Мы используем файлы cookie для улучшения вашего опыта на сайте, анализа трафика и показа релевантной рекламы. Продолжая использовать сайт, вы соглашаетесь с этим.</p>
            <button id="cookie-accept-btn" data-lang-key="cookie_accept">Принять</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/intlTelInput.min.js"></script>
    <script>
        // ===== УЛУЧШЕННЫЙ JAVASCRIPT ДЛЯ ЛЕНДИНГА ePRIME =====
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // ===== ДИНАМИЧЕСКАЯ ЗАМЕНА КОНТЕНТА =====
            const dynamicContent = {
                ru: {
                    default: {
                        hero_title: "Солнце работает, <span class=\"highlight\">вы отдыхаете</span>",
                        hero_subtitle: "Рассчитайте вашу экономию и окупаемость солнечной станции за 45 секунд и получите 3D-проект вашей крыши в подарок!",
                        hero_button: "Рассчитать экономию"
                    },
                    instalare_rapida: {
                        hero_title: "Установка солнечной станции <span class=\"highlight\">за 3 дня!</span>",
                        hero_subtitle: "Профессиональный монтаж под ключ с гарантией 5 лет. Получите расчет стоимости и 3D-проект бесплатно!",
                        hero_button: "Рассчитать стоимость установки"
                    },
                    pret_optim: {
                        hero_title: "Лучшая цена на солнечные <span class=\"highlight\">панели в Молдове</span>",
                        hero_subtitle: "Прямые поставки от производителя. Рассчитайте точную стоимость и срок окупаемости для вашего дома!",
                        hero_button: "Узнать лучшую цену"
                    },
                    panouri_calitate: {
                        hero_title: "Премиальные солнечные панели <span class=\"highlight\">с гарантией 25 лет</span>",
                        hero_subtitle: "Только Tier-1 производители. Рассчитайте производительность вашей будущей станции и получите 3D-проект!",
                        hero_button: "Рассчитать производительность"
                    },
                    business_solutions: {
                        hero_title: "Солнечные решения для <span class=\"highlight\">вашего бизнеса</span>",
                        hero_subtitle: "Снизьте расходы на электроэнергию до 90%. Специальные условия для компаний и рассрочка 0%!",
                        hero_button: "Рассчитать для бизнеса"
                    }
                },
                ro: {
                    default: {
                        hero_title: "Soarele lucrează, <span class=\"highlight\">dumneavoastră vă odihniți</span>",
                        hero_subtitle: "Calculați economiile și perioada de recuperare a investiției pentru stația solară în 45 de secunde și primiți un proiect 3D al acoperișului cadou!",
                        hero_button: "Calculează economiile"
                    },
                    instalare_rapida: {
                        hero_title: "Instalare stație solară <span class=\"highlight\">în 3 zile!</span>",
                        hero_subtitle: "Montaj profesional la cheie cu garanție 5 ani. Primiți calculul costului și proiectul 3D gratuit!",
                        hero_button: "Calculează costul instalării"
                    },
                    pret_optim: {
                        hero_title: "Cel mai bun preț pentru <span class=\"highlight\">panourile solare din Moldova</span>",
                        hero_subtitle: "Furnizare directă de la producător. Calculați costul exact și perioada de recuperare pentru casa dvs.!",
                        hero_button: "Află cel mai bun preț"
                    },
                    panouri_calitate: {
                        hero_title: "Panouri solare premium <span class=\"highlight\">cu garanție 25 de ani</span>",
                        hero_subtitle: "Doar producători Tier-1. Calculați performanța stației dvs. viitoare și primiți proiectul 3D!",
                        hero_button: "Calculează performanța"
                    },
                    business_solutions: {
                        hero_title: "Soluții solare pentru <span class=\"highlight\">afacerea dvs.</span>",
                        hero_subtitle: "Reduceți costurile la energie electrică cu până la 90%. Condiții speciale pentru companii și rate 0%!",
                        hero_button: "Calculează pentru afacere"
                    }
                }
            };

            // ===== ПЕРЕВОДЫ =====
            const translations = {
                ru: {
                    meta_title: "ePrime Solar: Расчет экономии на солнечных панелях в Молдове",
                    meta_description: "Узнайте, сколько вы можете сэкономить с солнечной станцией от ePrime.md. Пройдите быстрый калькулятор и получите расчет и 3D-проект на WhatsApp.",
                    hero_title: "Солнце работает, <span class=\"highlight\">вы отдыхаете</span>",
                    hero_subtitle: "Рассчитайте вашу экономию и окупаемость солнечной станции за 45 секунд и получите 3D-проект вашей крыши в подарок!",
                    hero_button: "Рассчитать экономию",
                    step1_title: "Ваш ежемесячный счет за электроэнергию? (MDL)",
                    bill_1: "до 1000",
                    bill_2: "1001 - 2000",
                    bill_3: "2001 - 3000",
                    bill_4: "3000+",
                    step2_title: "Какой у вас тип крыши?",
                    'Односкатная': 'Односкатная',
                    'Двускатная': 'Двускатная',
                    'Плоская': 'Плоская',
                    'Другой': 'Другой / Не знаю',
                    results_title: "Ваш предварительный расчет готов!",
                    results_savings: "Экономия в год с ePrime",
                    results_payback: "Срок окупаемости",
                    form_intro: "Получите точный расчет, 3D-проект и специальное предложение на WhatsApp!",
                    form_button: "Получить расчет",
                    form_bonus: "Оставив номер, вы получите бонус при монтаже",
                    thanks_title: "Спасибо! Ваша заявка принята!",
                    thanks_subtitle: "Наш специалист скоро свяжется с вами. А пока, узнайте о нас больше:",
                    link_projects_title: "Наши проекты",
                    link_projects_desc: "Посмотрите реальные примеры наших работ.",
                    link_home_title: "Решения для дома",
                    link_home_desc: "Узнайте все о станциях для частных домов.",
                    link_biz_title: "Решения для бизнеса",
                    link_biz_desc: "Оптимизируйте расходы вашей компании.",
                    link_main_title: "Основной сайт",
                    link_main_desc: "Перейдите на главный сайт ePrime.",
                    video_title: "Посмотрите, как мы работаем",
                    cookie_text: "Мы используем файлы cookie для улучшения вашего опыта на сайте, анализа трафика и показа релевантной рекламы. Продолжая использовать сайт, вы соглашаетесь с этим.",
                    cookie_accept: "Принять",
                    phone_error_invalid: "Неверный номер телефона",
                    phone_error_starts_zero: "Номер не должен начинаться с 0",
                    geolocation_denied: "Клиент не предоставил доступ к геолокации."
                },
                ro: {
                    meta_title: "ePrime Solar: Calculați economiile la panourile solare în Moldova",
                    meta_description: "Aflați cât puteți economisi cu o stație solară de la ePrime.md. Utilizați calculatorul rapid și primiți un calcul și un proiect 3D pe WhatsApp.",
                    hero_title: "Soarele lucrează, <span class=\"highlight\">dumneavoastră vă odihniți</span>",
                    hero_subtitle: "Calculați economiile și perioada de recuperare a investiției pentru stația solară în 45 de secunde și primiți un proiect 3D al acoperișului cadou!",
                    hero_button: "Calculează economiile",
                    step1_title: "Factura lunară la energia electrică? (MDL)",
                    bill_1: "până la 1000",
                    bill_2: "1001 - 2000",
                    bill_3: "2001 - 3000",
                    bill_4: "3000+",
                    step2_title: "Ce tip de acoperiș aveți?",
                    'Односкатная': 'Cu o singură pantă',
                    'Двускатная': 'În două pante',
                    'Плоская': 'Plan',
                    'Другой': 'Altul / Nu știu',
                    results_title: "Calculul preliminar este gata!",
                    results_savings: "Economii anuale cu ePrime",
                    results_payback: "Perioada de recuperare",
                    form_intro: "Primiți un calcul exact, un proiect 3D și o ofertă specială pe WhatsApp!",
                    form_button: "Obține calculul",
                    form_bonus: "Lăsând numărul, veți primi un bonus la instalare",
                    thanks_title: "Mulțumim! Solicitarea a fost acceptată!",
                    thanks_subtitle: "Specialistul nostru vă va contacta în curând. Între timp, aflați mai multe despre noi:",
                    link_projects_title: "Proiectele noastre",
                    link_projects_desc: "Vedeți exemple reale ale lucrărilor noastre.",
                    link_home_title: "Soluții pentru acasă",
                    link_home_desc: "Aflați totul despre stațiile pentru case private.",
                    link_biz_title: "Soluții pentru afaceri",
                    link_biz_desc: "Optimizați cheltuielile companiei dvs.",
                    link_main_title: "Site-ul principal",
                    link_main_desc: "Accesați site-ul principal ePrime.",
                    video_title: "Vedeți cum lucrăm",
                    cookie_text: "Folosim cookie-uri pentru a vă îmbunătăți experiența pe site, pentru a analiza traficul și pentru a afișa reclame relevante. Continuând să utilizați site-ul, sunteți de acord cu aceasta.",
                    cookie_accept: "Accept",
                    phone_error_invalid: "Număr de telefon invalid",
                    phone_error_starts_zero: "Numărul nu trebuie să înceapă cu 0",
                    geolocation_denied: "Clientul nu a oferit acces la geolocație."
                }
            };

            // ===== ПЕРЕМЕННЫЕ =====
            let currentLang = 'ru';
            let currentContent = 'default';
            let canTrack = false;
            let sessionTimers = {};
            let userChoices = {};

            // ===== ЭЛЕМЕНТЫ DOM =====
            const langRuBtn = document.getElementById('lang-ru');
            const langRoBtn = document.getElementById('lang-ro');
            const modal = document.getElementById('modal');
            const startBtn = document.getElementById('start-calc-btn');
            const closeBtn = document.getElementById('modal-close-btn');
            const steps = document.querySelectorAll('.calc-step');
            const optionButtons = document.querySelectorAll('.option-btn');
            const phoneInput = document.querySelector("#phone");
            const errorMsg = document.querySelector("#error-msg");
            const form = document.getElementById('phone-form');
            const cookieBanner = document.getElementById('cookie-banner');
            const acceptCookieBtn = document.getElementById('cookie-accept-btn');

            // ===== ИНИЦИАЛИЗАЦИЯ =====
            function init() {
                setupLanguageSwitcher();
                setupCalculator();
                setupPhoneValidation();
                setupCookieBanner();
                setupDynamicContent();
                trackEvent('page_view');
            }

            // ===== ДИНАМИЧЕСКАЯ ЗАМЕНА КОНТЕНТА =====
            function setupDynamicContent() {
                const urlParams = new URLSearchParams(window.location.search);
                const utmContent = urlParams.get('utm_content');
                const langParam = urlParams.get('lang');
                
                if (utmContent && dynamicContent.ru[utmContent]) {
                    currentContent = utmContent;
                    applyDynamicContent();
                }
                
                if (langParam && (langParam === 'ru' || langParam === 'ro')) {
                    setLanguage(langParam);
                }
            }

            function applyDynamicContent() {
                const content = dynamicContent[currentLang][currentContent] || dynamicContent[currentLang].default;
                
                // Обновляем заголовок
                const heroTitle = document.querySelector('[data-lang-key="hero_title"]');
                if (heroTitle) {
                    heroTitle.innerHTML = content.hero_title;
                }
                
                // Обновляем подзаголовок
                const heroSubtitle = document.querySelector('[data-lang-key="hero_subtitle"]');
                if (heroSubtitle) {
                    heroSubtitle.textContent = content.hero_subtitle;
                }
                
                // Обновляем кнопку
                const heroButton = document.querySelector('[data-lang-key="hero_button"]');
                if (heroButton) {
                    heroButton.textContent = content.hero_button;
                }
            }

            // ===== ПЕРЕКЛЮЧАТЕЛЬ ЯЗЫКОВ =====
            function setupLanguageSwitcher() {
                langRuBtn.addEventListener('click', () => setLanguage('ru'));
                langRoBtn.addEventListener('click', () => setLanguage('ro'));
            }

            function setLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                
                // Обновляем переводы
                document.querySelectorAll('[data-lang-key]').forEach(element => {
                    const key = element.getAttribute('data-lang-key');
                    if (translations[lang] && translations[lang][key]) {
                        element.innerHTML = translations[lang][key];
                    }
                });
                
                // Обновляем активную кнопку языка
                langRuBtn.classList.toggle('active', lang === 'ru');
                langRoBtn.classList.toggle('active', lang === 'ro');
                
                // Применяем динамический контент для нового языка
                applyDynamicContent();
            }

            // ===== КАЛЬКУЛЯТОР =====
            function setupCalculator() {
                startBtn.addEventListener('click', () => {
                    modal.classList.add('active');
                    trackEvent('calculator_opened');
                });
                
                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('active');
                    setTimeout(() => showStep('step1'), 400);
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                        setTimeout(() => showStep('step1'), 400);
                    }
                });

                optionButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const currentStep = button.closest('.calc-step');
                        const nextStepId = button.dataset.next;
                        userChoices[currentStep.id] = button.dataset.value;

                        if (nextStepId === 'results-step') {
                            calculateResults();
                            trackEvent('calculator_completed', { choices: userChoices });
                        } else {
                            trackEvent('calculator_step_completed', { 
                                step: currentStep.id, 
                                value: button.dataset.value 
                            });
                        }
                        
                        showStep(nextStepId);
                    });
                });
            }

            function showStep(stepId) {
                steps.forEach(step => step.classList.remove('active'));
                document.getElementById(stepId).classList.add('active');
            }

            function calculateResults() {
                const monthlyBill = parseFloat(userChoices.step1) || 1500;
                const annualSavings = Math.round((monthlyBill * 12) * 0.8) * 2;
                let stationCost;
                
                if (monthlyBill <= 1000) stationCost = 75000;
                else if (monthlyBill <= 2000) stationCost = 110000;
                else if (monthlyBill <= 3000) stationCost = 150000;
                else stationCost = 200000;
                
                const payback = Math.round(stationCost / annualSavings);

                document.getElementById('annual-savings').textContent = `~${annualSavings.toLocaleString('ru-RU')} MDL`;
                document.getElementById('payback-period').textContent = `~${payback} ${currentLang === 'ru' ? 'лет' : 'ani'}`;
            }

            // ===== ВАЛИДАЦИЯ ТЕЛЕФОНА =====
            function setupPhoneValidation() {
                const phoneInputInstance = window.intlTelInput(phoneInput, {
                    initialCountry: "md",
                    preferredCountries: ['md', 'ro', 'ua', 'ru'],
                    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.13/js/utils.js",
                });

                const resetValidation = () => {
                    errorMsg.style.display = "none";
                    phoneInput.classList.remove('error');
                };

                const showError = (message) => {
                    errorMsg.textContent = message;
                    errorMsg.style.display = "block";
                    phoneInput.classList.add('error');
                };

                const isPhoneValid = () => {
                    resetValidation();
                    if (phoneInput.value.trim()) {
                        if (phoneInputInstance.isValidNumber()) {
                            const countryData = phoneInputInstance.getSelectedCountryData();
                            const number = phoneInput.value.trim();
                            if ((countryData.iso2 === 'md' || countryData.iso2 === 'ro') && number.startsWith('0')) {
                                showError(translations[currentLang].phone_error_starts_zero);
                                return false;
                            }
                            return true;
                        } else {
                            showError(translations[currentLang].phone_error_invalid);
                            return false;
                        }
                    } else {
                        showError(translations[currentLang].phone_error_invalid);
                        return false;
                    }
                };

                phoneInput.addEventListener('input', isPhoneValid);
                phoneInput.addEventListener('countrychange', isPhoneValid);

                // Обработка отправки формы
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!isPhoneValid()) {
                        return;
                    }

                    const submitBtn = document.getElementById('submit-lead-btn');
                    const originalBtnText = submitBtn.textContent;
                    submitBtn.disabled = true;
                    submitBtn.textContent = '...';

                    const fullNumber = phoneInputInstance.getNumber();

                    // Получение геолокации
                    const location = await getGeolocation();
                    let geolocationInfo = '';
                    if (location) {
                        geolocationInfo = `\n- Геолокация клиента (ссылка на карту):\nhttps://www.google.com/maps?q=${location.lat},${location.lon}`;
                    } else if (isMobileDevice()) {
                        geolocationInfo = `\n- ${translations[currentLang].geolocation_denied}`;
                    }
                    
                    // Сбор аналитики для лида
                    trackEvent('lead_form_submitted');
                    const firstVisit = localStorage.getItem('first_visit_timestamp');
                    const sessionStart = sessionTimers['page_view'] || Date.now();
                    const calcStart = sessionTimers['calculator_opened'] || sessionStart;
                    const submitTime = sessionTimers['lead_form_submitted'];

                    const timeOnSite = formatDuration(submitTime - sessionStart);
                    const timeInCalc = formatDuration(submitTime - calcStart);
                    
                    let analyticsSummary = `
                        Аналитика и поведение клиента:
                        - Первый визит на сайт: ${firstVisit ? new Date(firstVisit).toLocaleString() : 'Не отслежено (cookie)'}
                        - Время на сайте до заявки: ${timeOnSite}
                        - Время, затраченное на расчет: ${timeInCalc}
                        - Источник: ${currentContent}
                        - Язык: ${currentLang.toUpperCase()}
                        ${geolocationInfo}
                    `;
                    
                    const webhookURL = 'https://crm.eprimebusiness.md/rest/3/1w6otlj1xrvscmam/crm.lead.add.json';

                    const data = {
                        fields: {
                            TITLE: `Заявка с калькулятора ePrime (${new Date().toLocaleString()})`,
                            NAME: "Клиент с лендинга",
                            PHONE: [{ VALUE: fullNumber, VALUE_TYPE: "WORK" }],
                            SOURCE_ID: "WEB",
                            COMMENTS: `
                                Данные из калькулятора:
                                - Ежемесячный счет: ${userChoices.step1 || 'не указан'} MDL
                                - Тип крыши: ${userChoices.step2 || 'не указан'}
                                - Расчетная экономия: ${document.getElementById('annual-savings').textContent}
                                - Расчетный срок окупаемости: ${document.getElementById('payback-period').textContent}
                                - Язык сайта: ${currentLang.toUpperCase()}
                                - Источник: ${currentContent}
                                
                                -----------------
                                ${canTrack ? analyticsSummary : 'Клиент не дал согласие на отслеживание.'}
                            `
                        },
                        params: { "REGISTER_SONET_EVENT": "Y" }
                    };

                    try {
                        const response = await fetch(webhookURL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        if (response.ok) {
                            if (canTrack) localStorage.removeItem('user_journey');
                            showThankYouPage();
                        } else { 
                            throw new Error('Bitrix24 API Error'); 
                        }
                    } catch (error) {
                        console.error('Ошибка отправки лида:', error);
                        alert('Произошла ошибка при отправке заявки. Пожалуйста, попробуйте еще раз.');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalBtnText;
                    }
                });
            }

            // ===== ГЕОЛОКАЦИЯ =====
            const isMobileDevice = () => /Mobi|Android/i.test(navigator.userAgent);

            const getGeolocation = () => {
                return new Promise((resolve) => {
                    if (isMobileDevice() && navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                resolve({
                                    lat: position.coords.latitude,
                                    lon: position.coords.longitude
                                });
                            },
                            () => {
                                resolve(null);
                            },
                            { timeout: 5000 }
                        );
                    } else {
                        resolve(null);
                    }
                });
            };

            // ===== СТРАНИЦА БЛАГОДАРНОСТИ =====
            const showThankYouPage = () => {
                const header = document.querySelector('.header');
                const hero = document.querySelector('.hero');
                const thankYouPage = document.getElementById('thank-you-page');

                modal.classList.remove('active');
                header.style.opacity = '0';
                hero.style.opacity = '0';
                
                setTimeout(() => {
                    header.style.display = 'none';
                    hero.style.display = 'none';
                    thankYouPage.style.display = 'block';
                    window.scrollTo(0, 0);
                }, 500);
            };

            // ===== COOKIE И ОТСЛЕЖИВАНИЕ =====
            function setupCookieBanner() {
                canTrack = localStorage.getItem('cookie_consent') === 'true';
                
                if (localStorage.getItem('cookie_consent') !== 'true') {
                    setTimeout(() => {
                        cookieBanner.classList.add('show');
                    }, 2000);
                } else {
                    if (!localStorage.getItem('first_visit_timestamp')) {
                        localStorage.setItem('first_visit_timestamp', new Date().toISOString());
                    }
                }

                acceptCookieBtn.addEventListener('click', () => {
                    localStorage.setItem('cookie_consent', 'true');
                    if (!localStorage.getItem('first_visit_timestamp')) {
                        localStorage.setItem('first_visit_timestamp', new Date().toISOString());
                    }
                    canTrack = true;
                    cookieBanner.classList.remove('show');
                    trackEvent('cookie_consent_given');
                });
            }

            const formatDuration = (ms) => {
                if (ms < 0) ms = 0;
                const seconds = Math.floor((ms / 1000) % 60);
                const minutes = Math.floor((ms / (1000 * 60)) % 60);
                const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
                
                let parts = [];
                if (hours > 0) parts.push(`${hours} ч`);
                if (minutes > 0) parts.push(`${minutes} мин`);
                if (seconds > 0 || parts.length === 0) parts.push(`${seconds} сек`);
                
                return parts.join(' ');
            };

            const trackEvent = (eventName, data = {}) => {
                if (!canTrack) return;
                sessionTimers[eventName] = Date.now();
                
                // Здесь можно добавить отправку в Google Analytics, Facebook Pixel и т.д.
                console.log(`Event: ${eventName}`, data);
            };

            // ===== ЗАПУСК =====
            init();
        });
    </script>
</body>
</html>